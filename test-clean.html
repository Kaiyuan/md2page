<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸…ç†ç‰ˆæœ¬æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        
        h1 {
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 0.5rem;
        }
        
        #test-results {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        #test-results p {
            margin: 0.5rem 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <h1>æ¸…ç†ç‰ˆæœ¬ç±»åº“æµ‹è¯•</h1>
    <div id="test-results">
        <p>æ­£åœ¨æµ‹è¯•æ¸…ç†ç‰ˆæœ¬çš„ç±»åº“...</p>
    </div>

    <!-- å¼•å…¥ marked.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    
    <!-- åº”ç”¨è„šæœ¬ - ä½¿ç”¨æ¸…ç†ç‰ˆæœ¬ -->
    <script src="./js/classes-clean.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const resultsDiv = document.getElementById('test-results');
            
            function addResult(message, type = 'info') {
                const p = document.createElement('p');
                p.textContent = message;
                p.className = type;
                resultsDiv.appendChild(p);
                console.log(message);
            }
            
            addResult('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•æ¸…ç†ç‰ˆæœ¬...', 'info');
            
            // æ£€æŸ¥ä¾èµ–åº“
            if (typeof marked === 'undefined') {
                addResult('âŒ marked.js åº“æœªåŠ è½½', 'error');
                return;
            } else {
                addResult('âœ… marked.js åº“åŠ è½½æˆåŠŸ', 'success');
            }
            
            // æµ‹è¯•ç±»å®šä¹‰
            const classTests = [
                ['MarkdownConverter', MarkdownConverter],
                ['FileHandler', FileHandler],
                ['ThemeManager', ThemeManager],
                ['PrintOptimizer', PrintOptimizer],
                ['ErrorHandler', ErrorHandler]
            ];
            
            let allClassesDefined = true;
            
            classTests.forEach(([name, cls]) => {
                if (typeof cls === 'function') {
                    addResult(`âœ… ${name} ç±»å®šä¹‰æ­£ç¡®`, 'success');
                } else {
                    addResult(`âŒ ${name} ç±»æœªå®šä¹‰æˆ–ä¸æ˜¯å‡½æ•°`, 'error');
                    allClassesDefined = false;
                }
            });
            
            if (!allClassesDefined) {
                addResult('âŒ éƒ¨åˆ†ç±»æœªæ­£ç¡®å®šä¹‰ï¼Œåœæ­¢æµ‹è¯•', 'error');
                return;
            }
            
            // æµ‹è¯•å®ä¾‹åˆ›å»º
            addResult('å¼€å§‹æµ‹è¯•å®ä¾‹åˆ›å»º...', 'info');
            
            try {
                const converter = new MarkdownConverter();
                addResult('âœ… MarkdownConverter å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                const fileHandler = new FileHandler();
                addResult('âœ… FileHandler å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                const themeManager = new ThemeManager();
                addResult('âœ… ThemeManager å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                const printOptimizer = new PrintOptimizer();
                addResult('âœ… PrintOptimizer å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                const errorHandler = new ErrorHandler();
                addResult('âœ… ErrorHandler å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                addResult('ğŸ‰ æ‰€æœ‰ç±»éƒ½æ­£å¸¸å·¥ä½œï¼', 'success');
                
                // æµ‹è¯•åŸºæœ¬åŠŸèƒ½
                addResult('å¼€å§‹æµ‹è¯•åŸºæœ¬åŠŸèƒ½...', 'info');
                const testMarkdown = '# æµ‹è¯•æ ‡é¢˜\n\nè¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ®µè½ã€‚\n\n## äºŒçº§æ ‡é¢˜\n\n- åˆ—è¡¨é¡¹1\n- åˆ—è¡¨é¡¹2';
                const html = converter.parseMarkdown(testMarkdown);
                
                if (html && html.includes('<h1') && html.includes('<h2') && html.includes('<ul>')) {
                    addResult('âœ… Markdown è§£ææµ‹è¯•æˆåŠŸ', 'success');
                    addResult(`è§£æç»“æœé¢„è§ˆ: ${html.substring(0, 100)}...`, 'info');
                } else {
                    addResult('âŒ Markdown è§£ææµ‹è¯•å¤±è´¥', 'error');
                }
                
                // æµ‹è¯•ä¸»é¢˜ç®¡ç†
                const currentTheme = themeManager.getCurrentTheme();
                addResult(`âœ… å½“å‰ä¸»é¢˜: ${currentTheme}`, 'success');
                
                // æµ‹è¯•æ–‡ä»¶åç”Ÿæˆ
                const filename = fileHandler.generateFilename(html);
                addResult(`âœ… ç”Ÿæˆæ–‡ä»¶å: ${filename}`, 'success');
                
                addResult('ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼æ¸…ç†ç‰ˆæœ¬å·¥ä½œæ­£å¸¸ï¼', 'success');
                
            } catch (error) {
                addResult(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                console.error('è¯¦ç»†é”™è¯¯:', error);
            }
        });
        
        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            const resultsDiv = document.getElementById('test-results');
            if (resultsDiv) {
                const p = document.createElement('p');
                p.textContent = `âŒ å…¨å±€é”™è¯¯: ${e.message}`;
                p.className = 'error';
                resultsDiv.appendChild(p);
            }
            console.error('å…¨å±€é”™è¯¯:', e);
        });
    </script>
</body>
</html>